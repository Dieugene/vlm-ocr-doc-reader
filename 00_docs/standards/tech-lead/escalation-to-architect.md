# Эскалация к Architect

Когда и как Tech Lead эскалирует вопросы к Architect.

## Когда эскалировать

### ✅ Эскалируй когда:

**1. Противоречия в архитектуре**
- ADR противоречат друг другу
- Overview и ADR не согласуются
- Архитектурные решения блокируют итеративность

**2. Критические зависимости**
- Зависимости блокируют параллельную работу
- Невозможно разбить на итерации без изменения архитектуры
- Циклические зависимости между модулями

**3. Отсутствующие архитектурные решения**
- Нужно решение которое влияет на архитектуру
- Выбор между альтернативными подходами
- Технологический выбор не сделан

**4. Нереализуемость**
- Архитектура требует недоступные технологии
- Производительность/масштабируемость под вопросом
- Архитектура слишком сложна для итеративной реализации

### ❌ НЕ эскалируй когда:

- Нужно выбрать структуру данных (это для Analyst)
- Вопросы реализации деталей (это для Analyst)
- Проблемы с кодом (это для Developer)
- Нужно просто уточнение терминологии

## Как эскалировать

### 1. Создай файл вопросов

```markdown
# Вопросы к Architect от Tech Lead

## Контекст

[Над чем работаешь, что пытаешься спланировать]

## Проблема

[Конкретное описание проблемы]

**Где обнаружено:**
- Файл: 00_docs/architecture/overview.md
- Раздел: [название раздела]
- ADR: decision_003_название.md (если релевантно)

**Суть проблемы:**
[Детальное описание]

## Варианты решения

### Вариант A: [Название]

**Описание:** [как можно решить]

**Плюсы:**
- [преимущество 1]
- [преимущество 2]

**Минусы:**
- [недостаток 1]
- [недостаток 2]

**Влияние на план:**
- [как повлияет на implementation plan]

### Вариант B: [Название]

[Аналогично]

## Рекомендация

[Твое мнение какой вариант лучше и почему]

## Вопрос

[Конкретный вопрос к Architect]
```

Сохрани в: `00_docs/architecture/_questions_architect.md`

### 2. Сформируй промпт для Architect

```
Ты - Architect (см. .agents/architect.md).

Прочитай:
- .agents/architect.md
- AGENTS.md
- 00_docs/standards/common/*
- 00_docs/standards/architect/*
- 00_docs/architecture/overview.md
- 00_docs/architecture/_questions_architect.md

Tech Lead обнаружил проблему при планировании реализации.
Нужно принять архитектурное решение.

После решения создай/обнови ADR и сформируй промпт для возврата Tech Lead.
```

### 3. Ожидай ответ

Architect:
- Прочитает вопросы
- Примет архитектурное решение
- Создаст или обновит ADR
- Сформирует промпт для возврата

### 4. Продолжи работу

После получения промпта от Architect:
- Прочитай обновленный/новый ADR
- Удали `_questions_architect.md`
- Обнови implementation plan с учетом решения
- Продолжи планирование

## Примеры эскалации

### Пример 1: Циклические зависимости

```markdown
# Вопросы к Architect от Tech Lead

## Контекст

Планирую порядок реализации модулей для коллективной работы на базе AI.

## Проблема

**Где обнаружено:**
- Файл: 00_docs/architecture/overview.md
- Раздел: "Архитектура модулей"

**Суть проблемы:**
Обнаружена циклическая зависимость:
- PersonalAssistant зависит от DataBus (для обмена данными)
- DataBus зависит от PersonalAssistant (для получения контекста)

Это блокирует итеративную разработку - нельзя реализовать один модуль без другого.

## Варианты решения

### Вариант A: Ввести промежуточный слой (EventBus)

**Описание:** Создать EventBus между PersonalAssistant и DataBus

**Плюсы:**
- Разрывает циклическую зависимость
- Асинхронное взаимодействие
- Легко мокировать

**Минусы:**
- Дополнительная сложность
- Еще один модуль для реализации

**Влияние на план:**
- Итерация 1: EventBus (простой)
- Итерация 2: PersonalAssistant
- Итерация 3: DataBus

### Вариант B: Инверсия зависимости через интерфейсы

**Описание:** DataBus зависит от интерфейса IContextProvider который реализует PersonalAssistant

**Плюсы:**
- Нет дополнительных модулей
- Четкие контракты

**Минусы:**
- Требует изменения архитектуры
- Сложнее для понимания

**Влияние на план:**
- Итерация 1: Интерфейсы + DataBus
- Итерация 2: PersonalAssistant с реализацией интерфейса

## Рекомендация

Вариант A (EventBus) - проще для итеративной разработки и тестирования.

## Вопрос

Какой подход выбрать для разрыва циклической зависимости?
Или есть третий вариант?
```

### Пример 2: Отсутствующее архитектурное решение

```markdown
# Вопросы к Architect от Tech Lead

## Контекст

Планирую стратегию моков для ранних итераций.

## Проблема

**Где обнаружено:**
- Файл: 00_docs/architecture/overview.md
- Раздел: "Персистентность данных"

**Суть проблемы:**
В архитектуре указано "персистентное хранилище данных" но не указан тип:
- Реляционная БД (PostgreSQL)?
- Документная БД (MongoDB)?
- Key-Value (Redis)?

Это критично для планирования моков первой итерации.

## Варианты решения

### Вариант A: PostgreSQL

**Плюсы:**
- Структурированные данные
- ACID транзакции
- Хорошая типизация

**Минусы:**
- Миграции схемы
- Сложнее мокировать

**Влияние на план:**
Мок: in-memory SQLite для ранних итераций

### Вариант B: MongoDB

**Плюсы:**
- Гибкая схема
- Легко начать
- Простой мок (объект в памяти)

**Минусы:**
- Менее строгая типизация
- Нет ACID

**Влияние на план:**
Мок: простой Map<string, object> в памяти

## Рекомендация

Нужно архитектурное решение о типе хранилища.

## Вопрос

Какой тип хранилища использовать для персистентности?
```

## Формат ответа от Architect

Architect создаст ADR:

```markdown
# ADR 005: Event-Driven Architecture для разрыва зависимостей

## Статус
Принято

## Контекст
Tech Lead обнаружил циклическую зависимость между PersonalAssistant и DataBus.

## Решение
Используем EventBus как промежуточный слой...

[детали решения]
```

И сформирует промпт:

```
Ты - Tech Lead (см. .agents/tech-lead.md).

Прочитай:
- .agents/tech-lead.md
- AGENTS.md
- 00_docs/standards/common/*
- 00_docs/standards/tech-lead/*
- 00_docs/architecture/decision_005_event-driven.md

Вопрос решен через ADR 005. Циклическая зависимость разрывается через EventBus.

Продолжи создание implementation plan с учетом нового решения.
Удали _questions_architect.md.
```

## Чеклист перед эскалацией

- [ ] Проблема действительно архитектурная
- [ ] Я предложил варианты решения
- [ ] Указал конкретные файлы и места
- [ ] Описал влияние на implementation plan
- [ ] Вопрос сформулирован конкретно
