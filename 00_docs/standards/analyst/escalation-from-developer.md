# Реагирование на эскалацию от Developer

Как принимать и обрабатывать вопросы эскалированные к тебе от Developer.

## Когда Developer эскалирует к тебе

- Технический план неполон или противоречив
- Обнаружены блокирующие технические проблемы
- Требуются уточнения по реализации
- Найдены несоответствия в `analysis.md`

## Процесс реагирования

### 1. Изучи вопросы

Прочитай `01_tasks/NNN/_questions_analyst.md` и пойми:
- В чем проблема с техническим планом
- Что блокирует Developer
- Какие есть варианты решения

### 2. Изучи контекст

Прочитай файлы из промпта:
- `01_tasks/NNN/analysis_NN.md` - твой план
- `01_tasks/NNN/task_brief_01.md` - исходные требования
- Релевантные ADR если вопрос касается архитектуры

### 3. Определи тип проблемы

**Если проблема в твоем плане:**
- Дополни или исправь технический план
- Создай `analysis_0(N+1).md` с исправлениями

**Если требуется архитектурное решение:**
- Эскалируй к Architect
- Создай `_questions_architect.md`
- Останови работу пока Architect не ответит

### 4. Обнови технический план

Создай `analysis_0(N+1).md` с дополнениями:

```markdown
# Технический план: <Название> (v2)

[Сохрани работающие части из analysis_01.md]

## [Раздел с проблемой]

[Исправленная/дополненная версия]

**Обновлено на основе вопросов Developer:**
- [Что исправлено]
- [Что дополнено]

[Остальные разделы]
```

### 5. Сформируй ответ Developer

```markdown
Технический план обновлен:
- [Краткое описание изменений]
- См. `01_tasks/NNN/analysis_02.md`
- Developer может продолжать реализацию
```

### 6. Сформируй промпт для продолжения

```
Ты — агент Developer (см. .agents/developer.md).

Прочитай:
- .agents/developer.md
- 01_tasks/NNN/_questions_analyst.md
- 01_tasks/NNN/analysis_02.md
- [другие релевантные файлы]

Контекст: Analyst обновил технический план с учетом твоих вопросов. Продолжай реализацию.

Задача: Реализуй функционал согласно обновленному техническому плану.

После завершения сообщи Analyst.
```

## Примеры

### Пример 1: Неполнота плана

**Вопрос Developer:**
```markdown
## Вопрос: Обработка ошибок валидации

**Проблема:**
В analysis_01.md описан EmailValidator, но не указано:
- Какой формат ошибок возвращать?
- Где логировать failed валидации?
- Retry policy для DNS lookup?

**Блокирует:**
Невозможно реализовать error handling без этих деталей.
```

**Твои действия:**
1. Создай `analysis_02.md`
2. Дополни раздел про EmailValidator:
```markdown
### 3.2.1 EmailValidator

[Previous content]

**Error Handling:**
- Возвращай ValidationError с кодом и сообщением
- Формат: {code: "INVALID_EMAIL_FORMAT", message: "..."}
- Логируй в validation.log с уровнем WARNING
- DNS lookup: 1 retry с 5 sec timeout, затем fallback на format-only check
```

### Пример 2: Противоречие в плане

**Вопрос Developer:**
```markdown
## Вопрос: Противоречие в хранении данных

**Проблема:**
- Раздел 3.3 говорит хранить в PostgreSQL
- Раздел 4.2 упоминает Redis cache
- Но не указано что именно в Redis

**Блокирует:**
Непонятна data flow между PostgreSQL и Redis.
```

**Твои действия:**
1. Создай `analysis_02.md`
2. Исправь и дополни:
```markdown
### 3.3 Хранение данных

**PostgreSQL (primary storage):**
- User profiles
- Transaction history

**Redis (cache layer):**
- User sessions (TTL 24h)
- Email validation results (TTL 1h)
- Rate limiting counters

**Data flow:**
1. Read: Check Redis → если miss → Read PostgreSQL → Write Redis
2. Write: Write PostgreSQL → Invalidate Redis
```

### Пример 3: Требуется архитектурное решение

**Вопрос Developer:**
```markdown
## Вопрос: Интеграция с payment gateway

**Проблема:**
Analysis предлагает прямую интеграцию, но это изменит
публичный API checkout endpoint.

**Блокирует:**
Это архитектурное решение, не могу реализовать без одобрения.
```

**Твои действия:**
1. Эскалируй к Architect
2. Создай `_questions_architect.md` с вопросом
3. Дождись ADR
4. Обнови `analysis` с учетом ADR
5. Верни Developer к работе

## Важно

- **Будь конкретен:** Исправляй/дополняй план четко
- **Сохраняй работающее:** Не переписывай весь план
- **Эскалируй вовремя:** Архитектурные вопросы - к Architect
- **Помоги продолжить:** Сформируй промпт для Developer
