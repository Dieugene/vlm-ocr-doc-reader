# Эскалация к Architect

Когда и как эскалировать архитектурные вопросы к Architect.

## Когда эскалировать

- Решение влияет на несколько модулей/компонентов
- Нужен выбор между технологиями/библиотеками
- Противоречие существующей архитектуре
- Изменение публичных API или интерфейсов
- Решение имеет долгосрочные последствия для проекта

## ВАЖНО: Проверь существующее

**Перед эскалацией выбора технологии:**
1. Проверь что уже используется в проекте
2. Прочитай `00_docs/architecture/overview.md`
3. Прочитай релевантные ADR
4. Используй существующее если оно подходит

**Эскалируй выбор новой технологии ТОЛЬКО если подходящей в проекте нет.**

## Процесс эскалации

### Шаг 1: Создай файл с вопросами

Создай `01_tasks/NNN/_questions_architect.md`:

```markdown
# Вопросы для Architect

**От:** Analyst
**Дата:** YYYY-MM-DD

## Вопрос 1: [Короткое название]

**Контекст:**
[Почему возник вопрос, что пытаемся решить]

**Проблема:**
[В чем конкретно проблема]

**Варианты:**

### Вариант A: [Название]
- **Подход:** [описание]
- **Плюсы:** ...
- **Минусы:** ...

### Вариант B: [Название]
- **Подход:** [описание]
- **Плюсы:** ...
- **Минусы:** ...

**Твоя рекомендация:**
[Что ты предлагаешь и почему]

**Блокирует:**
[Почему без решения невозможно продолжать создание ТЗ]

---

## Вопрос 2: [Если есть]
...
```

### Шаг 2: Сформируй промпт для Architect

```
Ты — агент Architect (см. .agents/architect.md).

Прочитай:
- .agents/architect.md
- 01_tasks/NNN_название/_questions_architect.md
- 00_docs/architecture/overview.md
- [другие релевантные ADR если нужно]

Задача: Ответь на архитектурные вопросы от Analyst. Создай или обнови релевантные ADR.

После ответа сформируй промпт для возврата Analyst к работе.
```

### Шаг 3: Положи промпт в чат

Используй markdown блок (```) для удобного копирования пользователем.

### Шаг 4: Останови работу над analysis

**НЕ продолжай работу над `analysis_NN.md`** пока Architect не ответит и не создаст ADR.

## Примеры хороших эскалаций

### Пример 1: Выбор технологии

```markdown
## Вопрос: Библиотека для валидации данных

**Контекст:**
Нужна валидация входных данных API. В проекте используется Flask, 
но библиотеки для валидации нет.

**Проблема:**
Требуется выбрать библиотеку валидации для унификации подхода.

**Варианты:**

### Вариант A: Marshmallow
- **Подход:** ORM-agnostic, декларативные схемы
- **Плюсы:** Популярна, хорошо интегрируется с Flask
- **Минусы:** Более многословная

### Вариант B: Pydantic
- **Подход:** Type hints + runtime валидация
- **Плюсы:** Современный подход, меньше кода
- **Минусы:** Требует Python 3.7+

**Рекомендация:**
Pydantic - проект уже на Python 3.9, синтаксис чище.

**Блокирует:**
Без выбора невозможно спроектировать data models.
```

### Пример 2: Изменение API

```markdown
## Вопрос: Структура ответа API для списков

**Контекст:**
Существующий endpoint /api/users возвращает массив напрямую: [user1, user2].
Новый endpoint /api/posts должен поддерживать пагинацию.

**Проблема:**
Нужно решить использовать новую структуру или сохранить consistency.

**Варианты:**

### Вариант A: Новая структура для /posts
- **Подход:** {items: [], page: 1, total: 100}
- **Плюсы:** Поддержка пагинации
- **Минусы:** Inconsistency с /users

### Вариант B: Мигрировать /users на новую структуру
- **Подход:** Обновить оба endpoint
- **Плюсы:** Единообразие
- **Минусы:** Breaking change для клиентов

**Рекомендация:**
Вариант B - consistency важнее, можно сделать через API версионирование.

**Блокирует:**
Структура ответа влияет на все endpoint design.
```

## Чего НЕ эскалировать

❌ **Не эскалируй:**
- Выбор имен переменных/функций
- Детали реализации внутри модуля
- Вопросы покрытые существующими ADR
- Использование библиотеки которая уже есть в проекте

## После получения ответа

Architect создаст ADR и сформирует промпт для твоего возврата к работе.

Ты получишь промпт который укажет:
- Прочитать `_questions_architect.md`
- Прочитать новый ADR
- Продолжить создание `analysis_NN.md` с учетом решения
